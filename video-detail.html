<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Détail Vidéo - Football News</title>
    <link rel="stylesheet" href="styles.css" />
    <style>
      :root {
        --accent-color: #3b82f6;
        --bg-dark: #000;
        --bg-card: #181818;
        --text-primary: #fff;
        --text-secondary: #b0b0b0;
        --border-color: #222;
        --bg-light: #f8fafc;
        --bg-card-light: #e5e7eb;
        --text-primary-light: #1e293b;
        --text-secondary-light: #334155;
        --border-color-light: #cbd5e1;
      }

      body[data-theme="light"] {
        --bg-dark: #f8fafc;
        --bg-card: #fff;
        --text-primary: #1e293b;
        --text-secondary: #334155;
        --border-color: #cbd5e1;
      }

      /* Navbar styles */
      .navbar.minimal-navbar {
        background: #fff;
        border-bottom: 1px solid #e5e7eb;
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.04);
        padding: 0.8rem 0;
        position: sticky;
        top: 0;
        z-index: 1000;
        transition: all 0.3s ease;
      }

      body[data-theme="dark"] .navbar.minimal-navbar {
        background: #111;
        border-bottom: 1px solid #222;
      }

      .nav-flex {
        display: flex;
        align-items: center;
        justify-content: space-between;
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 1.5rem;
      }

      .logo-left {
        display: flex;
        align-items: center;
        gap: 0.8rem;
        text-decoration: none;
      }

      .logo-icon {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 36px;
        height: 36px;
        background: var(--accent-color);
        border-radius: 8px;
        color: white;
        font-weight: bold;
        font-size: 1.2rem;
      }

      .logo-text {
        font-size: 1.4rem;
        font-weight: 700;
        color: var(--text-primary-light);
        letter-spacing: 0.5px;
        transition: color 0.2s;
      }

      body[data-theme="dark"] .logo-text {
        color: #fff;
      }

      .nav-links.nav-right {
        display: flex;
        align-items: center;
        gap: 2rem;
        list-style: none;
        margin: 0;
        padding: 0;
      }

      .nav-links.nav-right a {
        color: var(--text-primary-light);
        text-decoration: none;
        font-size: 1.05rem;
        font-weight: 500;
        padding: 0.5rem 0.8rem;
        border-radius: 6px;
        transition: all 0.2s ease;
        position: relative;
      }

      body[data-theme="dark"] .nav-links.nav-right a {
        color: #fff;
      }

      .nav-links.nav-right a:hover {
        background: rgba(59, 130, 246, 0.1);
        color: var(--accent-color);
      }

      .burger-btn {
        display: none;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        width: 44px;
        height: 44px;
        background: none;
        border: none;
        cursor: pointer;
        z-index: 1001;
        padding: 0;
        border-radius: 8px;
        transition: background 0.2s;
      }

      .burger-btn:hover {
        background: rgba(0, 0, 0, 0.05);
      }

      body[data-theme="dark"] .burger-btn:hover {
        background: rgba(255, 255, 255, 0.1);
      }

      .burger-bar {
        width: 24px;
        height: 2px;
        background: var(--text-primary-light);
        margin: 3px 0;
        border-radius: 2px;
        transition: all 0.3s ease;
      }

      body[data-theme="dark"] .burger-bar {
        background: #fff;
      }

      @media (max-width: 800px) {
        .nav-links.nav-right {
          gap: 1rem;
        }
      }

      @media (max-width: 700px) {
        .burger-btn {
          display: flex;
        }

        .nav-menu {
          position: fixed;
          top: 0;
          right: 0;
          width: 85vw;
          max-width: 360px;
          height: 100vh;
          background: var(--bg-light);
          box-shadow: -4px 0 24px rgba(0, 0, 0, 0.12);
          border-top-left-radius: 20px;
          border-bottom-left-radius: 20px;
          display: flex;
          flex-direction: column;
          align-items: flex-start;
          justify-content: flex-start;
          transform: translateX(100vw);
          transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
          z-index: 1000;
          padding: 2rem;
        }

        body[data-theme="dark"] .nav-menu {
          background: var(--bg-dark);
        }

        .nav-menu.open {
          transform: translateX(0);
        }

        .nav-links.nav-right {
          flex-direction: column;
          align-items: flex-start;
          gap: 1.5rem;
          margin-top: 5rem;
          width: 100%;
        }

        .nav-links.nav-right li {
          width: 100%;
        }

        .nav-links.nav-right a {
          display: block;
          width: 100%;
          font-size: 1.15rem;
          padding: 0.8rem 1rem;
          border-radius: 8px;
          color: var(--text-primary-light) !important;
        }

        body[data-theme="dark"] .nav-links.nav-right a {
          color: #fff !important;
        }

        .nav-links.nav-right a:hover {
          background: rgba(59, 130, 246, 0.1);
        }
      }

      @media (min-width: 701px) {
        .nav-menu {
          position: static;
          transform: none;
          background: none;
          height: auto;
          width: auto;
          display: flex;
          align-items: center;
          justify-content: flex-end;
          padding: 0;
        }

        .nav-links.nav-right {
          flex-direction: row;
          gap: 1.5rem;
          margin-top: 0;
        }
      }
      .video-detail {
        max-width: 900px;
        margin: 2rem auto;
        padding: 2rem;
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 4px 24px rgba(0, 0, 0, 0.1);
      }
      .video-header {
        margin-bottom: 2rem;
      }
      .video-title {
        font-size: 2.2rem;
        color: var(--text-primary);
        margin-bottom: 1rem;
        line-height: 1.2;
      }
      .video-meta {
        display: flex;
        align-items: center;
        gap: 1.5rem;
        color: var(--text-secondary);
        font-size: 0.95rem;
        margin-bottom: 1.5rem;
      }
      .video-iframe {
        width: 100%;
        max-width: 800px;
        height: 450px;
        border-radius: 8px;
        margin-bottom: 2rem;
        background: #000;
        display: block;
      }
      .video-description {
        font-size: 1.1rem;
        line-height: 1.8;
        color: var(--text-primary);
        margin-bottom: 2rem;
      }
      .comments-section {
        margin-top: 2.5rem;
        background: #f8fafc;
        border-radius: 8px;
        padding: 1.5rem;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
      }
      .comment {
        border-bottom: 1px solid #e5e7eb;
        padding: 1rem 0;
      }
      .comment:last-child {
        border-bottom: none;
      }
      .comment-author {
        font-weight: bold;
        color: #2563eb;
      }
      .comment-date {
        color: #64748b;
        font-size: 0.95rem;
        margin-left: 1rem;
      }
      .comment-content {
        margin-top: 0.5rem;
        color: #1e293b;
      }
      .add-comment-form {
        margin-top: 1.5rem;
        display: flex;
        flex-direction: column;
        gap: 0.7rem;
      }
      .add-comment-form textarea {
        min-height: 70px;
        border-radius: 6px;
        border: 1px solid #cbd5e1;
        padding: 0.7rem;
        font-size: 1rem;
      }
      .add-comment-form button {
        align-self: flex-end;
        background: var(--accent-color);
        color: #fff;
        border: none;
        border-radius: 6px;
        padding: 0.6rem 1.5rem;
        font-weight: 500;
        cursor: pointer;
        transition: background 0.2s;
      }
      .add-comment-form button:hover {
        background: #2563eb;
      }
      @media (max-width: 700px) {
        .video-detail {
          margin: 1rem;
          padding: 1rem;
        }
        .video-iframe {
          height: 220px;
        }
        .video-title {
          font-size: 1.3rem;
        }
      }
    </style>
  </head>
  <body data-theme="light">
    <nav class="navbar minimal-navbar">
      <div class="container nav-flex">
        <a href="index.html" class="logo-left">
          <span class="logo-icon">FN</span>
          <span class="logo-text">Football News</span>
        </a>
        <button class="burger-btn" id="burgerBtn" aria-label="Menu">
          <span class="burger-bar"></span>
          <span class="burger-bar"></span>
          <span class="burger-bar"></span>
        </button>
        <div class="nav-menu" id="navMenu">
          <ul class="nav-links nav-right" id="navLinks">
            <li><a href="index.html#news">News</a></li>
            <li><a href="index.html#histoire">Histoire</a></li>
            <li><a href="index.html#videos">Vidéos</a></li>
            <li>
              <a href="admin.html" id="adminLink" style="display: none"
                >Administration</a
              >
            </li>
            <li>
              <a href="#" id="logoutButton" style="display: none"
                >Déconnexion</a
              >
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <div class="container">
      <a href="index.html#videos" class="back-button">← Retour aux vidéos</a>
      <div class="video-detail" id="videoDetail">
        <!-- Le contenu de la vidéo sera injecté ici dynamiquement -->
      </div>
    </div>
    <div class="loading-overlay" id="loadingOverlay" style="display: none">
      <div class="loading-spinner"></div>
    </div>
    <div class="error-message" id="errorMessage" style="display: none"></div>
    <script>
      // Gestion du menu burger
      const burgerBtn = document.getElementById("burgerBtn");
      const navMenu = document.getElementById("navMenu");
      const navLinks = document.getElementById("navLinks");
      if (burgerBtn && navMenu && navLinks) {
        burgerBtn.addEventListener("click", () => {
          navMenu.classList.toggle("open");
          navLinks.classList.toggle("open");
        });
      }
      // Gestion du bouton de déconnexion
      const logoutButton = document.getElementById("logoutButton");
      const token = localStorage.getItem("token");
      if (logoutButton) {
        if (token) {
          logoutButton.style.display = "inline-block";
          logoutButton.onclick = function (e) {
            e.preventDefault();
            localStorage.removeItem("token");
            window.location.href = "login.html";
          };
        } else {
          logoutButton.style.display = "none";
        }
      }
      // Utilitaire pour extraire l'ID YouTube
      function getYouTubeId(url) {
        const regExp =
          /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
        const match = url.match(regExp);
        return match && match[2].length === 11 ? match[2] : null;
      }
      // Affichage du détail vidéo
      document.addEventListener("DOMContentLoaded", async function () {
        const loadingOverlay = document.getElementById("loadingOverlay");
        const videoDetail = document.getElementById("videoDetail");
        const errorMessage = document.getElementById("errorMessage");
        // Récupérer l'ID de la vidéo depuis l'URL
        const urlParams = new URLSearchParams(window.location.search);
        const videoId = urlParams.get("id");
        if (!videoId) {
          showError("ID de la vidéo non spécifié");
          return;
        }
        try {
          loadingOverlay.style.display = "flex";
          errorMessage.style.display = "none";
          // Récupérer la vidéo depuis l'API
          const response = await fetch(
            `https://newsfootbackend-production.up.railway.app/api/videos/${videoId}`
          );
          if (!response.ok) {
            throw new Error("Erreur lors du chargement de la vidéo");
          }
          const video = await response.json();
          document.title = `${video.titre} - Football News`;
          videoDetail.innerHTML = `
            <header class="video-header">
              <h1 class="video-title">${video.titre}</h1>
              <div class="video-meta">
                <span>Par ${video.auteur_prenom} ${video.auteur_nom}</span>
                <span>•</span>
                <span>${new Date(video.date_creation).toLocaleDateString(
                  "fr-FR",
                  { year: "numeric", month: "long", day: "numeric" }
                )}</span>
                <span>•</span>
                <span>${video.categorie}</span>
              </div>
            </header>
            <iframe class="video-iframe" src="https://www.youtube.com/embed/${getYouTubeId(
              video.url_youtube
            )}" frameborder="0" allowfullscreen></iframe>
            <div class="video-description">${
              video.description ? video.description.replace(/\n/g, "<br>") : ""
            }</div>
          `;
        } catch (error) {
          console.error("Erreur:", error);
          showError("Une erreur est survenue lors du chargement de la vidéo");
        } finally {
          loadingOverlay.style.display = "none";
        }
      });
      function showError(message) {
        const errorMessage = document.getElementById("errorMessage");
        errorMessage.textContent = message;
        errorMessage.style.display = "block";
        document.getElementById("loadingOverlay").style.display = "none";
      }
      // Gestion des commentaires (affichage fictif, à brancher sur l'API si dispo)
      function renderComments() {
        const commentsList = document.getElementById("commentsList");
        const noCommentsMsg = document.getElementById("noCommentsMsg");
        // Exemple de commentaires fictifs (à remplacer par l'API plus tard)
        const comments = [];
        commentsList.innerHTML = comments
          .map(
            (comment) => `
          <div class='comment'>
            <span class='comment-author'>${comment.author}</span>
            <span class='comment-date'>${comment.date}</span>
            <div class='comment-content'>${comment.content}</div>
          </div>
        `
          )
          .join("");
        if (comments.length === 0) {
          noCommentsMsg.style.display = "block";
        } else {
          noCommentsMsg.style.display = "none";
        }
      }
      document.addEventListener("DOMContentLoaded", function () {
        renderComments();
      });
    </script>
  </body>
</html>
